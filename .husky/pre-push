#!/usr/bin/env bash
set -euo pipefail

# Always get the latest remote refs so our base exists
git fetch origin --quiet

# Detect remote default branch (falls back to main)
DEFAULT_BRANCH="$(git rev-parse --abbrev-ref origin/HEAD 2>/dev/null | sed 's@^origin/@@' || echo main)"

# Prefer diffing against the remote default branch
BASE="origin/${DEFAULT_BRANCH}"

# If that ref still doesn't exist (first push or detached state), fall back to previous commit
if ! git rev-parse "$BASE" >/dev/null 2>&1; then
  BASE="HEAD~1"
fi
